# =============================================================================
# ServiceAccount - Identidade para Processos em Pods
# =============================================================================
# ServiceAccount fornece uma identidade para processos executados em pods.
# Ao contrario de Users (humanos), ServiceAccounts sao gerenciados pelo K8s
# e sao usados por aplicacoes/processos.
#
# IMPORTANTE:
# - Cada namespace tem um ServiceAccount 'default' automatico
# - Pratica recomendada: criar SAs dedicados por aplicacao
# - Vincular permissoes minimas via RBAC (Roles/RoleBindings)
#
# Cenario: criar SA 'app-reader' que tera permissao apenas para LER pods
# =============================================================================

# Versao da API
apiVersion: v1

# Tipo do recurso
kind: ServiceAccount

# Metadados
metadata:
  # Nome do ServiceAccount
  name: app-reader
  # Namespace onde sera criado
  namespace: dev
  # Labels para organizacao
  labels:
    app: demo-api
    purpose: rbac-demo
    access-level: read-only

# Especificacao (opcional para ServiceAccount simples)
# spec:
#   # Secrets para autenticacao (criados automaticamente)
#   # secrets:
#   #   - name: app-reader-token

# =============================================================================
# COMO FUNCIONA
# =============================================================================
# 1. Quando criado, K8s gera automaticamente um token de autenticacao
# 2. Token e armazenado em um Secret associado ao SA
# 3. Pods configurados com este SA tem o token montado em:
#    /var/run/secrets/kubernetes.io/serviceaccount/token
# 4. Apps dentro do pod podem usar esse token para autenticar com API Server
# 5. Permissoes sao definidas via Roles/RoleBindings associados ao SA
# =============================================================================

# =============================================================================
# BOAS PRATICAS
# =============================================================================
# - Criar SA dedicado por aplicacao (nao usar 'default')
# - Nomear de forma descritiva (app-reader, metrics-collector, etc)
# - Aplicar principio de privilegio minimo via Roles
# - Revisar periodicamente SAs nao utilizados
# - Usar automountServiceAccountToken: false se app nao precisa acessar API
# =============================================================================
